aggregate(data_df_select, by = list((realized+unrealized),FUN = sum)
aggregate(data_df_select, by = list((realized+unrealized),FUN = sum))
aggregate(data_df_select, by = list((realized,unrealized),FUN = sum))
aggregate(data_df_select, by = list(realized,unrealized),FUN = sum)
aggregate(data_df_select, by = list(data_df_select$realized,data_df_select$unrealized),FUN = sum)
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trade.Date, 'm/d/Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
View(pruned_model1)
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trade.Date, '%m/%d/%Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
View(pruned_model1)
pruned_model1 <- select(model1, Account.Name, Security, as.Date(Trade.Date, '%m/%d/%Y'), as.numeric(Realized.PnL.Gross), as.numeric(Unrealized.Changed..Day.Wise.), as.numeric(GMV), as.numeric(NMV))
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trad.Date, '%m/%d/%Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trade.Date, '%m/%d/%Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
data_df_select <- select(data_df, -acct, -sym, date,realized,unrealized,-gmv,-nmv)
aggregate(data_df_select, by = list(data_df_select$realized,data_df_select$unrealized),FUN = sum)
data_df_select <- select(data_df, -acct, -sym, -date,realized,unrealized,-gmv,-nmv)
aggregate(data_df_select, by = list(data_df_select$realized,data_df_select$unrealized),FUN = sum)
pnl_agg <- aggregate(data_df_select, by = list(data_df_select$realized,data_df_select$unrealized),FUN = sum)
View(pnl_agg)
pnl_agg <- group_by(data_df, date, aggregate(data_df_select, by = list(data_df_select$realized,data_df_select$unrealized),FUN = sum))
grouped_byacct <- group_by(data_df,acct)
View(grouped_byacct)
grouped_byacct <- group_by(data_df,date)
View(grouped_byacct)
melt(df,date)
melt(data_df,date)
melt(data_df,acct)
melt(data_df,data_df$acct)
tail(data_df)
files <- list.files(pattern="*.csv")
for (i in 1:length(files)) {
inp <- read.csv(file=files[i], header=TRUE)
cname <- name <- sub(".csv", "", files[i])
cat("Read:", files[i], "\trows: ", nrow(inp), " cols: ", ncol(inp), "\n")
assign( name, inp)
}
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trade.Date, '%m/%d/%Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
pruned_model2 <- data.frame(model2$Account.Name, model2$Security, as.Date(model2$Trade.Date, '%m/%d/%Y'), as.numeric(model2$Realized.PnL.Gross),as.numeric(model2$Unrealized.Changed..Day.Wise.),as.numeric(model2$GMV),as.numeric(model2$NMV))
pruned_model3 <- data.frame(model3$Account.Name, model3$Security, as.Date(model3$Trade.Date, '%m/%d/%Y'), as.numeric(model3$Realized.PnL.Gross),as.numeric(model3$Unrealized.Changed..Day.Wise.),as.numeric(model3$GMV),as.numeric(model3$NMV))
pruned_model4 <- data.frame(model4$Account.Name, model4$Security, as.Date(model4$Trade.Date, '%m/%d/%Y'), as.numeric(model4$Realized.PnL.Gross),as.numeric(model4$Unrealized.Changed..Day.Wise.),as.numeric(model4$GMV),as.numeric(model4$NMV))
pruned_model5 <- data.frame(model5$Account.Name, model5$Security, as.Date(model5$Trade.Date, '%m/%d/%Y'), as.numeric(model5$Realized.PnL.Gross),as.numeric(model5$Unrealized.Changed..Day.Wise.),as.numeric(model5$GMV),as.numeric(model5$NMV))
pruned_model6 <- data.frame(model6$Account.Name, model6$Security, as.Date(model6$Trade.Date, '%m/%d/%Y'), as.numeric(model6$Realized.PnL.Gross),as.numeric(model6$Unrealized.Changed..Day.Wise.),as.numeric(model6$GMV),as.numeric(model6$NMV))
pruned_model7 <- data.frame(model7$Account.Name, model7$Security, as.Date(model7$Trade.Date, '%m/%d/%Y'), as.numeric(model7$Realized.PnL.Gross),as.numeric(model7$Unrealized.Changed..Day.Wise.),as.numeric(model7$GMV),as.numeric(model7$NMV))
pruned_model8 <- data.frame(model8$Account.Name, model8$Security, as.Date(model8$Trade.Date, '%m/%d/%Y'), as.numeric(model8$Realized.PnL.Gross),as.numeric(model8$Unrealized.Changed..Day.Wise.),as.numeric(model8$GMV),as.numeric(model8$NMV))
pruned_model9 <- data.frame(model9$Account.Name, model9$Security, as.Date(model9$Trade.Date, '%m/%d/%Y'), as.numeric(model9$Realized.PnL.Gross),as.numeric(model9$Unrealized.Changed..Day.Wise.),as.numeric(model9$GMV),as.numeric(model9$NMV))
pruned_model10 <- data.frame(model10$Account.Name, model10$Security, as.Date(model10$Trade.Date, '%m/%d/%Y'), as.numeric(model10$Realized.PnL.Gross),as.numeric(model10$Unrealized.Changed..Day.Wise.),as.numeric(model10$GMV),as.numeric(model10$NMV))
pruned_model11 <- data.frame(model11$Account.Name, model11$Security, as.Date(model11$Trade.Date, '%m/%d/%Y'), as.numeric(model11$Realized.PnL.Gross),as.numeric(model11$Unrealized.Changed..Day.Wise.),as.numeric(model11$GMV),as.numeric(model11$NMV))
rename columns to simplify
colnames(pruned_model1) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model2) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model3) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model4) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model5) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model6) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model7) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model8) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model9) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model10) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model11) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
data_df <- rbind(pruned_model1, pruned_model2, pruned_model3, pruned_model4, pruned_model5, pruned_model6, pruned_model7, pruned_model8, pruned_model9, pruned_model10, pruned_model11)
grouped_byacct <- group_by(data_df,acct)
View(grouped_byacct)
grouped_byacct <- group_by(data_df, list(date,acct,sym))
grouped_byacct <- group_by(data_df, list(date,acct))
grouped_byacct <- group_by(data_df, list(date))
grouped_byacct <- group_by(data_df, data_df$date)
grouped_byacct <- group_by(data_df, data_df$acct)
melt(data_df,date)
melt(data_df,data_df$date)
melt(data_df,date)
melt(data_df,sym)
View(data_df)
grp <- group_by(data_df, (realized+unrealized),sym)
View(grp)
grp <- group_by(data_df, sym,(realized+unrealized))
View(grp)
grp <- data_df %>%
group_by(sym) %>%
summarise(totalpnl = sum(realized,na.rm = TRUE))
grp
View(grp)
grp2 <- data_df %>%
group_by(date)%>%
summarise(pnlbyday = sum(realized,na.rm = TRUE))
grp2
pnl_dist_sym <- data_df %>%
group_by(sym) %>%
summarise(totalpnl = sum(realized, ra.rm = TRUE))
pnl_dist_day <- data_df %>%
group_by(sym) %>%
summarise(totalpnl_day = sum(realized, ra.rm = TRUE))
View(pnl_dist_sym)
View(pnl_dist_day)
pnl_dist_day <- data_df %>%
group_by(date) %>%
summarise(totalpnl_day = sum(realized, ra.rm = TRUE))
View(pnl_dist_day)
dbWriteTable(con, "pnl_dist_sym", pnl_dist_sym)
dbWriteTable(con, "pnl_dist_day", pnl_dist_day)
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname = "postgres", host = "localhost", port = 5433, user = "postgres", password = "z8yjcpfw")
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname = "postgres", host = "localhost", port = 5433, user = "postgres", password = "z8yjcpfw")
dbWriteTable(con, "pnl_dist_sym", pnl_dist_sym)
dbWriteTable(con, "pnl_dist_day", pnl_dist_day)
as.DataFrame(pnl_dist_sym)
pnl_dist_symdf <- Data.Frame(pnl_dist_sym)
pnl_dist_symdf <- data.frame(pnl_dist_sym)
pnl_dist_daydf <- data.frame(pnl_dist_day)
dbWriteTable(con, "pnl_dist_sym", pnl_dist_sym)
dbWriteTable(con, "pnl_dist_day", pnl_dist_day)
dbWriteTable(con, "pnl_dist_sym", pnl_dist_sym)
# connect to postgresql db
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname = "postgres", host = "localhost", port = 5433, user = "postgres", password = "z8yjcpfw")
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
dbDisconnect(con)
# connect to postgresql db
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname = "postgres", host = "localhost", port = 5433, user = "postgres", password = "z8yjcpfw")
dbWriteTable(con, "pnl_dist_sym", pnl_dist_sym)
pnl_dist_symdf <- data.frame(pnl_dist_sym)
dbWriteTable(con, "pnl_dist_symdf", pnl_dist_symdf)
pnl_dist_daydf <- data.frame(pnl_dist_day)
dbWriteTable(con, "pnl_dist_day", pnl_dist_day)
dbWriteTable(con, "pnl_dist_daydf", pnl_dist_daydf)
head(pnl_dist_daydf)
melted <- melt(pnl_dist_daydf)
melted <- melt(pnl_dist_symdf,sym)
melted <- melt(pnl_dist_daydf,totalpnl_day)
melted <- melt(pnl_dist_daydf,pnl_dist_daydf$totalpnl_day)
View(pnl_dist_symdf)
View(pnl_dist_daydf)
dim(dbGetQuery(con, "select * from pnl_dist_symdf"))
dim(dbGetQuery(con, "select * from pnl_dist_daydf"))
head(pnl_dist_symdf)
dim(dbGetQuery(con, "select * from pnl_dist_symdf"))[1]
dim(dbGetQuery(con, "select * from pnl_dist_daydf"))[1]
head(dbGetQuery(con, "select * from pnl_dist_daydf"))
tail(dbGetQuery(con, "select * from pnl_dist_daydf"))
head(dbGetQuery(con, "select * from pnl_dist_symdf"))
tail(dbGetQuery(con, "select * from pnl_dist_symdf"))
str(dbGetQuery(con, "select * from pnl_dist_symdf"))
str(dbGetQuery(con, "select * from pnl_dist_daydf"))
levels(dbGetQuery(con, "select * from pnl_dist_symdf"))
head(dbGetQuery(con, "select * from pnl_dist_symdf"))
levels(dbGetQuery(con, "select sym,totalpnl from pnl_dist_symdf"))
levels(dbGetQuery(con, "select sym from pnl_dist_symdf"))
levels(pnl_dist_symdf)
levels(dbGetQuery(con, "select totalpnl_day from pnl_dist_daydf"))
levels(pnl_dist_symdf$sym)
levels(pnl_dist_daydf$date)
head(pnl_dist_daydf)
levels(pnl_dist_daydf$totalpnl_day)
# symbols traded in the portfolio
levels(pnl_dist_symdf$sym)
# top and bottom sample of pnl by day data
head(dbGetQuery(con, "select * from pnl_dist_daydf"))
tail(dbGetQuery(con, "select * from pnl_dist_daydf"))
summary(dbGetQuery(con, "select * from pnl_dist_symdf"))
summary(dbGetQuery(con, "select sym from pnl_dist_symdf"))
summary(dbGetQuery(con, "select * from pnl_dist_daydf"))
summary(dbGetQuery(con, "select * from pnl_dist_symdf"))
summary(dbGetQuery(con, "select * from pnl_dist_daydf"))
library(ggplot2)
ggplot(pnl_dist_daydf, aes(x = pnl_dist_symdf$totalpnl, y = pnl_dist_symdf$sym))+geom_point(shape=1)
head(pnl_dist_symdf)
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$totalpnl, y = pnl_dist_symdf$sym))+geom_point(shape=1)
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+geom_smooth(method = lm, se = FALSE)
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+geom_smooth(method = lm)
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+ggtitle("PnL Distribution Over Symbols")
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+ggtitle("PnL Distribution Over Symbols",xlab = "sym", ylab = "pnl ($)")
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+ggtitle("PnL Distribution Over Symbols",xlab = "sym", ylab = "pnl ($)"))
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+ggtitle("PnL Distribution Over Symbols")+xlab("sym")+ylab("pnl ($)")
ggplot(pnl_dist_symbdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_boxplot()
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_boxplot()
ggplot(pnl_dist_symdf, aes(x = levels(pnl_dist_symdf$sym)))
plot(cumsum(pnl_dist_daydf$totalpnl))
plot(cumsum(pnl_dist_daydf$totalpnl, title = "cumulative pnl over days", xlab = "days", ylab = "pnl"))
plot(cumsum(pnl_dist_daydf$totalpnl), title = "cumulative pnl over days", xlab = "days", ylab = "pnl")
plot(cumsum(pnl_dist_daydf$totalpnl)+title = "cumulative pnl over days"+xlab = "days"+ ylab = "pnl")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_symdf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+title=("cumulative pnl over days")))
ggplot(pnl_dist_daydf, aes(x = pnl_dist_symdf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("cumulative pnl over days")))
head(pnl_dist_daydf)
ggplot(pnl_dist_daydf, aes(x = pnl_dist_symdf$date, y = cumsum(pnl_dist_daydf$totalpnl_day))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("cumulative pnl over days"))
ggplot(pnl_dist_daydf, aes(x = pnl_dist_symdf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("cumulative pnl over days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("cumulative pnl over days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day)))+geom_point(shape=1)+ggtitle("PnL Distribution Over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_point(shape=1)+ggtitle("PnL Distribution Over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_point(shape=1)+ggtitle("PnL Distribution Over Days")+xlab("date")+ylab("pnl ($)")
library(quantmod)
symbols <- c('SPY')
symbols <- c("SPY")
sym.list <- llply(symbols, get)
l_ply(symbols, function(sym) try(getSymbols(sym)))
symbols <- symbols[symbols %in% ls()]
library(plyr)
sym.list <- llply(symbols, get)
head(sym.list)
days = end-start
days = as.Date(end)-as.Date(start)
days = as.date(end)-as.date(start)
start = as.Date("2014-09-01",'%Y-%m-%m')
end = as.Date("2014-10-31",'%Y-%m-%m')
days = start-end
days
start = as.Date("2014-09-01",'%Y-%mm-%dd')
end = as.Date("2014-10-31",'%Y-%mm-%dd')
days = start-end
days
benchmark_data <- new.env()
getSymbols(symbols, env = benchmark_data, src = "yahoo", from = start, to = end)
head(SPY)
head(symbols)
symbols <- c("SPY")
symbols <- c("SPY")
benchmark_data <- new.env()
start = as.Date("2014-09-01")
end = as.Date("2014-10-31")
getSymbols(symbols, env = benchmark_data, src = "yahoo", from = start, to = end)
head(symbols$SPY)
head(SPY)
SPY
library(quantmod)
SPy
SPY
symbols$SPY
symbols.SPY
tickers <- c("SPY")
stockData <- new.env()
start = as.Date("2014-09-01")
end = as.Date("2014-10-31")
getSymbols(tickers, env = stockData, src = "yahoo", from = start, to = end)
spy
SPY
tickers
head(tickers$SPY)
tickers <- c("SPY")
stockData <- new.env()
start <- as.Date("2014-09-01")
end <- as.Date("2014-10-31")
library(quantmod)
getSymbols(tickers, env = stockData, src = "yahoo", from = start, to = end)
head(tickers$SPY)
start <- as.Date("2014-09-01")
end <- as.Date("2014-10-31")
getSymbols('SPY', src = "yahoo", from = start, to = end)
head(SPY)
closeSPY <- head(SPY.Close)
closeSPY <- head(SPY$SPY.Close)
adj_closeSPY <- head(SPY$SPY.Adjusted)
adj_closeSPY <- head(SPY$SPY.Adjusted)
plot(adj_closeSPY)
plot(log(adj_closeSPY))
plot(adj_closeSPY)
plot(adj_closeSPY, title = "benchmark return over days")
library(tseries)
install.packages("tseries")
library(tseries)
head(pnl_dist_daydf$totalpnl_day)
dollar_pnls <- pnl_dist_daydf$totalpnl_day
port_rets <- Return.calculate(dollar_pnls,method = "compound")
port_rets <- CumReturns(dollar_pnls,method = "simple")
port_rets <- Return.cumulative(dollar_pnls,method = "simple")
install.packages("PerformanceAnalytics")
library(PerformanceAnalytics)
port_rets <- Return.cumulative(dollar_pnls,method = "simple")
port_rets <- Return.cumulative(dollar_pnls)
View(port_rets)
port_rets <- Return.calculate(dollar_pnls)
library(zoo)
port_rets <- Return.calculate(dollar_pnls)
port_rets <- chart.Return(dollar_pnls)
ggplot() + geom_line(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day, color = "blue")) + geom_line(adj_closeSPY, color = "green")
View(adj_closeSPY)
start <- as.Date("2014-09-01")
end <- as.Date("2014-10-31")
adj_closeSPY <- SPY$SPY.Adjusted
ggplot() + geom_line(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day, color = "blue")) + geom_line(adj_closeSPY, color = "green")
ggplot() + geom_line(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day, color = "blue")) + plot(adj_closeSPY, color = "green")
g <- ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_point(shape=1)+ggtitle("PnL Distribution Over Days")+xlab("date")+ylab("pnl ($)")
g
g2 <- ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
g2
plot(b,g2)
b <- plot(adj_closeSPY, title = "benchmark return over days")
plot(adj_closeSPY, title = "benchmark return over days")
plot(adj_closeSPY, title = "benchmark return over days")
b <- charSeries(adj_closeSPY)
b <- chartSeries(adj_closeSPY)
plot(b,g2)
View(g2)
g2
plot(pnl_dist_daydf$totalpnl_day ~ adj_closeSPY)
ts.plot(pnl_dist_daydf$totalpnl_day,adj_closeSPY)
library(graphics)
ts.plot(pnl_dist_daydf$totalpnl_day,adj_closeSPY)
ts.plot(pnl_dist_daydf,adj_closeSPY)
plot(time, adj_closeSPY, type = '1', xlim = c(1,100), ylim = c(-500000.0,500000.0), xlab = 'date', ylab = 'pnl')
plot(time, adj_closeSPY, type = '1', xlim = c(1,100), ylim = c(0.0,1.0), xlab = 'date', ylab = 'pnl')
b <- chart_Series(adj_closeSPY)
b
getSymbols('SPY', 'VXX', src = "yahoo", from = start, to = end)
tickers <- c('SPY', 'VXX')
getSymbols(tickers, src = "yahoo", from = start, to = end)
adj_closeVXX <- VXX$VXX.Adjusted
View(adj_closeVXX)
b <- chart_Series(adj_closeSPY, adj_closeVXX)
b
b <- chart_Series(adj_closeSPY)
b
c <- chart_Series(adj_closeVXX)
c
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
library(zoo)
library(tseries)
library(PerformanceAnalytics)
library(graphics)
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
library(ggplot2)
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
library(zoo)
library(tseries)
library(PerformanceAnalytics)
library(graphics)
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
library(zoo)
library(tseries)
library(PerformanceAnalytics)
library(graphics)
# set wd
setwd("~/Desktop/is607FinalProject/rawdata")
# OBTAIN & SCRUB data. read performance data of 11 diff models from multiple csv files #into multiple data frames.  The goal is to get pnl by day across all models in the #portfolio and to get pnl distributed across symbol for all models in the portfolio into #a relational database for exploration and modelling.
# bring in market data for spy benchmark and store adj close prices into a variable
tickers <- c('SPY', 'VXX')
start <- as.Date("2014-09-01")
end <- as.Date("2014-10-31")
getSymbols(tickers, src = "yahoo", from = start, to = end)
adj_closeSPY <- SPY$SPY.Adjusted
adj_closeVXX <- VXX$VXX.Adjusted
pruned_model1 <- data.frame(model1$Account.Name, model1$Security, as.Date(model1$Trade.Date, '%m/%d/%Y'), as.numeric(model1$Realized.PnL.Gross),as.numeric(model1$Unrealized.Changed..Day.Wise.),as.numeric(model1$GMV),as.numeric(model1$NMV))
pruned_model2 <- data.frame(model2$Account.Name, model2$Security, as.Date(model2$Trade.Date, '%m/%d/%Y'), as.numeric(model2$Realized.PnL.Gross),as.numeric(model2$Unrealized.Changed..Day.Wise.),as.numeric(model2$GMV),as.numeric(model2$NMV))
pruned_model3 <- data.frame(model3$Account.Name, model3$Security, as.Date(model3$Trade.Date, '%m/%d/%Y'), as.numeric(model3$Realized.PnL.Gross),as.numeric(model3$Unrealized.Changed..Day.Wise.),as.numeric(model3$GMV),as.numeric(model3$NMV))
pruned_model4 <- data.frame(model4$Account.Name, model4$Security, as.Date(model4$Trade.Date, '%m/%d/%Y'), as.numeric(model4$Realized.PnL.Gross),as.numeric(model4$Unrealized.Changed..Day.Wise.),as.numeric(model4$GMV),as.numeric(model4$NMV))
pruned_model5 <- data.frame(model5$Account.Name, model5$Security, as.Date(model5$Trade.Date, '%m/%d/%Y'), as.numeric(model5$Realized.PnL.Gross),as.numeric(model5$Unrealized.Changed..Day.Wise.),as.numeric(model5$GMV),as.numeric(model5$NMV))
pruned_model6 <- data.frame(model6$Account.Name, model6$Security, as.Date(model6$Trade.Date, '%m/%d/%Y'), as.numeric(model6$Realized.PnL.Gross),as.numeric(model6$Unrealized.Changed..Day.Wise.),as.numeric(model6$GMV),as.numeric(model6$NMV))
pruned_model7 <- data.frame(model7$Account.Name, model7$Security, as.Date(model7$Trade.Date, '%m/%d/%Y'), as.numeric(model7$Realized.PnL.Gross),as.numeric(model7$Unrealized.Changed..Day.Wise.),as.numeric(model7$GMV),as.numeric(model7$NMV))
pruned_model8 <- data.frame(model8$Account.Name, model8$Security, as.Date(model8$Trade.Date, '%m/%d/%Y'), as.numeric(model8$Realized.PnL.Gross),as.numeric(model8$Unrealized.Changed..Day.Wise.),as.numeric(model8$GMV),as.numeric(model8$NMV))
pruned_model9 <- data.frame(model9$Account.Name, model9$Security, as.Date(model9$Trade.Date, '%m/%d/%Y'), as.numeric(model9$Realized.PnL.Gross),as.numeric(model9$Unrealized.Changed..Day.Wise.),as.numeric(model9$GMV),as.numeric(model9$NMV))
pruned_model10 <- data.frame(model10$Account.Name, model10$Security, as.Date(model10$Trade.Date, '%m/%d/%Y'), as.numeric(model10$Realized.PnL.Gross),as.numeric(model10$Unrealized.Changed..Day.Wise.),as.numeric(model10$GMV),as.numeric(model10$NMV))
pruned_model11 <- data.frame(model11$Account.Name, model11$Security, as.Date(model11$Trade.Date, '%m/%d/%Y'), as.numeric(model11$Realized.PnL.Gross),as.numeric(model11$Unrealized.Changed..Day.Wise.),as.numeric(model11$GMV),as.numeric(model11$NMV))
# rename columns to simplify
colnames(pruned_model1) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model2) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model3) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model4) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model5) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model6) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model7) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model8) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model9) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model10) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
colnames(pruned_model11) <- c('acct','sym','date','realized','unrealized','gmv','nmv')
# combine into one data frame
data_df <- rbind(pruned_model1, pruned_model2, pruned_model3, pruned_model4, pruned_model5, pruned_model6, pruned_model7, pruned_model8, pruned_model9, pruned_model10, pruned_model11)
# manipulate data - get aggregate pnl distribution by day, and by symbol
pnl_dist_sym <- data_df %>%
group_by(sym) %>%
summarise(totalpnl = sum(realized, ra.rm = TRUE))
pnl_dist_symdf <- data.frame(pnl_dist_sym)
pnl_dist_day <- data_df %>%
group_by(date) %>%
summarise(totalpnl_day = sum(realized, ra.rm = TRUE))
pnl_dist_daydf <- data.frame(pnl_dist_day)
# connect to postgresql db
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname = "postgres", host = "localhost", port = 5433, user = "postgres", password = "z8yjcpfw")
# write pnl_dist data
dbWriteTable(con, "pnl_dist_symdf", pnl_dist_symdf)
dbWriteTable(con, "pnl_dist_daydf", pnl_dist_daydf)
# EXPLORE DATA
# number of observations of symbols over which pnl is distributed
dim(dbGetQuery(con, "select * from pnl_dist_symdf"))[1]
# symbols traded in the portfolio
levels(pnl_dist_symdf$sym)
# data types pnl by sym table
str(dbGetQuery(con, "select * from pnl_dist_symdf"))
# top and bottom sample of pnl by symbol data
head(dbGetQuery(con, "select * from pnl_dist_symdf"))
tail(dbGetQuery(con, "select * from pnl_dist_symdf"))
# number of observations of days over which pnl is distributed
dim(dbGetQuery(con, "select * from pnl_dist_daydf"))[1]
# data types pnl by day table
str(dbGetQuery(con, "select * from pnl_dist_daydf"))
# top and bottom sample of pnl by day data
head(dbGetQuery(con, "select * from pnl_dist_daydf"))
tail(dbGetQuery(con, "select * from pnl_dist_daydf"))
# summarize pnl distribution by symbol
summary(dbGetQuery(con, "select * from pnl_dist_symdf"))
# summarize pnl distribution by day
summary(dbGetQuery(con, "select * from pnl_dist_daydf"))
# visualization of pnl distribution over symbols
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point(shape=1)+ggtitle("PnL Distribution Over Symbols")+xlab("sym")+ylab("pnl ($)")
# visualizations of pnl distribution over days
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_point(shape=1)+ggtitle("PnL Distribution Over Days")+xlab("date")+ylab("pnl ($)")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point(shape=1)+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
# visualization of benchmark over same period
chart_Series(adj_closeSPY)
# visualization of volatility index over same period
chart_Series(adj_closeVXX)
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point(shape=1)+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
cumpnl <- pnl_dist_daydf$totalpnl_day
cumpnl <- cumsum(pnl_dist_daydf$totalpnl_day)
View(cumpnl)
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day)))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cpnl_dist_daydf$totalpnl_day))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_line()+geom_point()+xlab("date")+ylab("cumulative pnl ($)")+ggtitle("Cumulative PnL over Days")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day))) + geom_line() + ggtitle("Cumulative PnL Over Days") + xlab("date") + ylab("Cumulative PnL ($)")
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = pnl_dist_daydf$totalpnl_day))+geom_point()+ggtitle("PnL Distribution Over Days")+xlab("date")+ylab("pnl ($)")
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point()+ggtitle("PnL Distribution Over Symbols")+xlab("sym")+ylab("pnl ($)")
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
library(zoo)
library(tseries)
library(PerformanceAnalytics)
detach("package:graphics", unload=TRUE)
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
library(zoo)
library(tseries)
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
detach("package:PerformanceAnalytics", unload=TRUE)
detach("package:zoo", unload=TRUE)
detach("package:tseries", unload=TRUE)
library(RPostgreSQL)
library(DBI)
library(dplyr)
library(plyr)
library(ggplot2)
library(quantmod)
chart_Series(adj_closeVXX)
library("zoo", lib.loc="/Library/Frameworks/R.framework/Versions/3.0/Resources/library")
library(zoo)
chart_Series(adj_closeVXX)
library("timeSeries", lib.loc="/Library/Frameworks/R.framework/Versions/3.0/Resources/library")
library(timeSeries)
chart_Series(adj_closeVXX)
ggplot(pnl_dist_daydf, aes(x = pnl_dist_daydf$date, y = cumsum(pnl_dist_daydf$totalpnl_day))) + geom_line() + ggtitle("Cumulative PnL Over Days") + xlab("date") + ylab("Cumulative PnL ($)")
ggplot2(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point()+ggtitle("PnL Distribution Over Symbols")+xlab("sym")+ylab("pnl ($)")
ggplot(pnl_dist_symdf, aes(x = pnl_dist_symdf$sym, y = pnl_dist_symdf$totalpnl))+geom_point()+ggtitle("PnL Distribution Over Symbols")+xlab("sym")+ylab("pnl ($)")
